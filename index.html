<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhaToon</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">
    
    <div class="header">
        <div class="header-logo-group" style="display: flex; align-items: center; gap: 10px;">
            <img src="images/icons/icon_logo.png" class="app-logo" alt="Logo" style="width: 32px; height: 32px; object-fit: contain;">
        </div>
        
        <div class="header-icons">
            <div class="icon-box" onclick="toggleTheme()">
                <img id="theme-icon" src="images/icons/icon_sun.png" class="icon-btn" alt="Theme">
                <span id="theme-text" class="icon-label" style="font-size: 10px; color:white;">Light</span>
            </div>
            
            <div class="icon-box" onclick="toggleBookmarks()">
                <img id="btn-library" src="images/icons/icon_library.png" class="icon-btn" alt="Library">
                <span class="icon-label" style="font-size: 10px; color:white;">Library</span>
            </div>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search stories..." onkeyup="handleSearch(event)">
        <button onclick="performSearch()">
            <img src="images/icons/icon_search.png" alt="Search">
        </button>
    </div>

    <div class="section-title">‚óè Story World</div>
    <a href="world.html?type=story" class="banner-wrapper">
        <img src="images/covers/banner_story.jpg" class="banner">
        <div class="banner-label">Story World <i class="css-arrow"></i></div>
    </a>
    <div id="list-story" class="scroll-container"></div>

    <div class="section-title">‚óè Novel World</div>
    <a href="world.html?type=novel" class="banner-wrapper">
        <img src="images/covers/banner_novel.jpg" class="banner">
        <div class="banner-label">Novel World <i class="css-arrow"></i></div>
    </a>
    <div id="list-novel" class="scroll-container"></div>

    <div class="section-title">‚óè Comic World</div>
    <a href="world.html?type=comic" class="banner-wrapper">
        <img src="images/covers/banner_comic.jpg" class="banner">
        <div class="banner-label">Comic World <i class="css-arrow"></i></div>
    </a>
    <div id="list-comic" class="scroll-container"></div>

    <div class="footer">
        ¬© 2026 AAN. All Rights Reserved.
    </div>

    <div id="bookmark-overlay" class="bookmark-overlay" onclick="toggleBookmarks()"></div>
    <div id="bookmark-drawer" class="bookmark-drawer">
        <div class="drawer-header">
            <span>My Library</span>
            <span onclick="toggleBookmarks()" style="cursor:pointer;">‚úï</span>
        </div>
        <div id="bookmark-list"></div>
    </div>

</div>

<script src="stories.js"></script>
<script src="app.js"></script>

<script>
    // --- 1. THEME TOGGLE LOGIC ---
    const themeIcon = document.getElementById("theme-icon");
    const themeText = document.getElementById("theme-text");

    function updateThemeUI(isLight) {
        if (isLight) {
            document.body.classList.add("light-mode");
            if(themeIcon) themeIcon.src = "images/icons/icon_moon.png"; 
            if(themeText) themeText.innerText = "Dark"; 
        } else {
            document.body.classList.remove("light-mode");
            if(themeIcon) themeIcon.src = "images/icons/icon_sun.png"; 
            if(themeText) themeText.innerText = "Light";
        }
    }

    const savedTheme = localStorage.getItem("theme");
    updateThemeUI(savedTheme === "light");

    function toggleTheme() {
        document.body.classList.toggle("light-mode");
        const isLight = document.body.classList.contains("light-mode");
        localStorage.setItem("theme", isLight ? "light" : "dark");
        updateThemeUI(isLight);
    }

    // --- 2. AUTOMATIC STORY LOADER ---
    const storyList = document.getElementById("list-story");
    const novelList = document.getElementById("list-novel");
    const comicList = document.getElementById("list-comic");

    for (let key in db) {
        let item = db[key];
        
        // üõë NEW CODE: SKIP IF NOT RELEASED
        if (item.released === false) { continue; } 

        // ... (rest of your existing code: Badge logic, HTML generation, etc.) ... 

        let badgeHTML = item.badge ? `<span class="badge ${item.badge === "NEW" ? "badge-new" : "badge-up"}">${item.badge}</span>` : "";

        let cardHTML = `
            <div class="story-card" onclick="location.href='view.html?id=${item.id}&from=home'">
                ${badgeHTML} 
                <img src="${item.cover}" class="story-cover">
                <div class="story-title">${item.title}</div>
                <div class="story-stats">${item.stats}</div>
            </div>
        `;

        if (item.type === 'story' && storyList) storyList.innerHTML += cardHTML;
        else if (item.type === 'novel' && novelList) novelList.innerHTML += cardHTML;
        else if (item.type === 'comic' && comicList) comicList.innerHTML += cardHTML;
    }

    enableDragScroll();

    // --- 3. BOOKMARK DRAWER LOGIC ---
    function toggleBookmarks() {
        const overlay = document.getElementById("bookmark-overlay");
        const drawer = document.getElementById("bookmark-drawer");
        const list = document.getElementById("bookmark-list");

        overlay.classList.toggle("active");
        drawer.classList.toggle("active");

        if (drawer.classList.contains("active")) {
            const bookmarks = JSON.parse(localStorage.getItem("khatoon_bookmarks")) || [];
            list.innerHTML = ""; 

            if (bookmarks.length === 0) {
                list.innerHTML = "<p style='color:gray; text-align:center;'>No saved stories yet.</p>";
            } else {
                bookmarks.forEach(book => {
                    list.innerHTML += `
                        <div class="bookmark-item">
                            <img src="${book.cover}" onclick="location.href='view.html?id=${book.id}'">
                            <div class="bookmark-info" onclick="location.href='view.html?id=${book.id}'">
                                <div style="font-weight:bold; font-size:14px; color:white;">${book.title}</div>
                                <div style="font-size:10px; color:gray;">${book.type.toUpperCase()}</div>
                            </div>
                            <button class="btn-remove" onclick="removeBookmark('${book.id}')">
    <img src="images/icons/icon_trash.png" alt="Delete">
</button>
                    `;
                });
            }
        }
    }

    function removeBookmark(id) {
        let bookmarks = JSON.parse(localStorage.getItem("khatoon_bookmarks")) || [];
        bookmarks = bookmarks.filter(b => b.id !== id);
        localStorage.setItem("khatoon_bookmarks", JSON.stringify(bookmarks));
        toggleBookmarks(); 
        toggleBookmarks(); 
    }
</script>

</body>
</html>